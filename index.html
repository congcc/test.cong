<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title><%= title %></title>
	<script src="/socket.io/socket.io.js"></script>
	<script src='jquery/dist/jquery.min.js'></script>
	<script src='bootstrap/dist/js/bootstrap.min.js'></script>

	<link rel="stylesheet" href="bootstrap/dist/css/bootstrap.min.css">
	<link rel="stylesheet" href="css/chat.css">

</head>
<body>
		<div class="container">
		
		<div class="row">
			<div class="col-md-6 col-md-offset-3">	
			<h1>聊天室</h1>
			</div>

		</div>

		<div class="row">

			<div class="col-md-6 col-md-offset-3 uname">
				
				  <div class="form-group">
				    <label for="exampleInputEmail1">昵称</label>
				    <input type="text" class="form-control" id="" placeholder="请输入昵称">
				  </div>
				  
				  <button type="submit" id='btn-uname' class="btn btn-default">下一步</button>
				


			</div>


		</div>

		<div class="row">

			<div class="col-md-6 col-md-offset-3 message" >


				<div id='dvs'>
					<!-- 昵称 二狗子 -->
					<!-- 你输入的信息 -->
					<!-- <div class='me'>
						<span class="label label-primary">me</span>
					
						我发送的消息
						<p class='ps'><span class="bg-danger">你好jgdkjgkdjglkdgljd</span></p>
					</div>
					
					
					<div class='you'>
						<span class="label label-success">you</span>
						
						你们发送的消息
						<p class='ps'><span class="bg-info">Success加快结构机构</span></p>
					
					</div> -->
				
				</div>

				<textarea class="form-control" id='contents' rows="3" style='margin-top:10px;resize:none'></textarea>

				<button class='btn btn-info' id='btn-send'>发送</button>


				</div>
			




		</div>
	</div><!-- 
	
	<script>
		//建立一个socket链接
		  var socket = io.connect('http://localhost');
	
			//监听服务端发送的消息 news参数与服务端emit第一个参数相同
		  	socket.on('news', function (data) {
	
		    	console.log(data);
			//往服务器发送消息
		    socket.emit('my other event', { my: 'data' });
		  });
		</script>
	 -->
	
	<script type="text/javascript">

	var socket= io('http://localhost');

	var nicheng='';

	$('#btn-uname').click(function(){
		//获取昵称
		var nicheng=$(':text').val();
		// console.log(nicheng);

		//如果框里内容是空的话让他返回
		if(nicheng=='')
			return;

		//让昵称框消失
		$('.uname').hide();

		//让消息框显示
		$('.message').show();

		//把昵称发送到服务器
		 socket.emit('uname',nicheng);


	})
	


	//发送按钮
	$('#btn-send').click(function(){
		//获取文本框里面输入的内容
		var contents=$('#contents').val();
		// console.log(contents);

		//如果文本框里面的内容为空则让他返回
		if(contents=='')
			return;

		//将内容发送到服务器
		socket.emit('contents',contents);

		//将内容设置为空
		$('#contents').val('');
	})


	//接受消息和昵称
	  	socket.on('msg', function(data){

	  		// console.log(data);
	  		//Object { uname="小六子",  contents="你吃了没????",  time="2017-11-01T01:14:46.295Z"}

	  		//判断昵称
	  		var flag = data.uname == nicheng;


	  		var xins = info(flag,data);


	  		$('#dvs').append(xins);

	  		

	  	})


	 	function info(flag, data)
	  	{
	  		var str = '';

	  		if(flag){

	  			 str = '<div class="me"> <span class="label label-primary">'+data.uname+'&nbsp;'+data.time+'</span> <p class="ps"><span class="bg-danger">'+data.contents+'</span></p> </div>';

	  		} else {

	  			str = '<div class="you"> <span class="label label-success">'+data.uname+'&nbsp;'+data.time+'</span> <p class="ps"><span class="bg-info">'+data.contents+'</span></p> </div>';


	  		}

	  			return str;
	  	}


	</script>
	 </body>
</html>